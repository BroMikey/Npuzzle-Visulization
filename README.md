# Visulization

此项目是一个可视化Puzzle求解器, 可以可视化搜索树和搜索过程.

## 安装SFML库

1. 下载2.6.1的sfml库，解压到任意目录。
2. 下载对应的编译器mingw(2.6.1对应的是mingw64-winlib-13.1.0)，解压到任意目录。
3. 将mingw64-winlib-13.1.0/bin目录添加到环境变量中。
4. 创建系统环境变量:CPLUS_INCLUDE_PATH添加到环境变量中，值为/path/to/sfml/include目录。
5. 创建系统环境变量:LIBRARY_PATH添加到环境变量中，值为/path/to/sfml/lib目录。
6. 配置C++属性, 将/path/to/sfml/lib目录添加到链接器的库目录中, 注意选择对应的编译器版本。
7. 配置task.json, 将-lsfml-graphics -lsfml-window -lsfml-system添加到链接器的输入中。

## 可视化

开屏, 可以编辑start state, 显示出默认的goal state. 最下方的两个view按钮分别对应以下两个可视化的功能:

1. 可视化为一棵树(可缩放)
2. 动画可视化搜索(不可缩放, 固定视角大小)

## 可视化为一棵树

### 绘制Puzzle状态树

#### 树结构构建
- 数据源: 从`solution.txt`文件读取搜索树数据
- 节点格式: 每行包含`节点编号 父节点编号 g值 h值 f值 状态数组`
- 树构建: 使用`TreeBuilder`类解析数据并构建树结构，建立父子关系
- 统计信息: 自动计算总节点数、最大深度、叶子节点数等统计信息

#### 树布局计算
- 布局算法: 使用自定义树布局算法计算节点坐标
- 参数配置: 
  - 水平间距: 250像素
  - 垂直间距: 200像素  
  - 节点大小: 根据BoardRenderer的实际尺寸动态调整
- 布局优化: 确保树结构清晰可读，避免节点重叠

#### 节点渲染
- 状态显示: 每个节点显示完整的Puzzle状态棋盘
- 代价函数: 在节点下方显示g(实际代价)、h(启发式代价)、f(总代价)值
- 颜色编码:
  - 根节点: 绿色边框
  - 叶子节点: 红色边框
  - 普通节点: 白色边框
  - 高亮节点: 黄色边框和背景

#### 连接线绘制
- 连线方式: 使用`sf::VertexArray(sf::Lines)`绘制父子节点间的连接线
- 连接点计算: 从父节点底部中点连接到子节点顶部中点
- 颜色设置: 默认灰色连接线，高亮路径使用黄色连接线
- 可见性控制: 只绘制当前可见节点间的连接线

#### 步进式显示
- 显示管理: 使用`DisplayManager`控制节点的显示顺序
- 按步绘制: 每次只渲染当前步骤的节点和连接线
- 自动播放: 支持可配置的播放间隔(默认100ms)
- 进度控制: 可前进、后退、重置到初始状态

### 交互功能
1. 高亮路径: 按H键高亮显示从根节点到当前节点的完整路径
2. 视图控制: 
   - 鼠标滚轮缩放视图
   - 鼠标拖拽平移视图
   - R键重置视图到初始状态
3. 步进控制: 
   - 左右方向键实现步进/步退
   - 空格键切换自动播放/暂停
4. 智能居中: 节点变化时自动居中显示当前节点
5. 返回功能: B键返回主编辑界面


## 动画可视化搜索

只显示一个节点, 但是可以根据solution.txt中的搜索过程, 动态显示搜索过程。(比如已知这一步是DOWN,就显示当前空白节点向下移动)
根据solutionAnimation.txt中内容(UP/DOWN/LEFT/RIGHT), 一步步显示当前节点移动的方向, 同时有auto模式, 同时可以手动暂停,选择上一步下一步进行播放。

### 绘制Puzzle移动动画

#### 动画数据解析
- 数据源: 从`solutionAnimation.txt`文件读取移动方向序列
- 移动方向: 包含UP、DOWN、LEFT、RIGHT四种移动指令
- 状态序列: 基于solution.txt中的状态序列进行动画演示

#### 动画渲染机制
- 单节点显示: 每次只显示一个Puzzle状态，通过位置变化模拟移动过程
- 位置计算: 根据移动方向计算节点在画布上的新位置
  - UP: 向上移动150像素
  - DOWN: 向下移动150像素  
  - LEFT: 向左移动150像素
  - RIGHT: 向右移动150像素
- 连接线显示: 可选择显示/隐藏前一步到当前步的连接线

#### 移动方向检测
- 空白格定位: 通过比较前后状态找到空白格的位置变化
- 方向判断: 根据空白格的行列变化确定移动方向
- 错误处理: 未知移动方向时返回"UNKNOWN"并跳过绘制

#### 可视化元素
- 方向指示器: 在Puzzle上方显示当前移动方向(UP/DOWN/LEFT/RIGHT)
- 步数计数器: 在Puzzle下方显示当前步数和总步数
- 连接线: 半透明灰色线条显示移动轨迹
- 字体支持: 使用系统字体显示文本信息

#### 动画控制
- 步进控制: 左右方向键控制前进一步/后退一步
- 自动播放: 空格键切换自动播放模式(默认500ms间隔)
- 重置功能: R键重置动画到初始状态
- 连接线切换: L键切换连接线的显示/隐藏
- 返回功能: B键返回主编辑界面

#### 视图管理
- 自动居中: 当前节点始终居中显示在视图中
- 视图控制: 支持鼠标拖拽和滚轮缩放视图
- 固定视角: 与树视图不同，动画视图采用固定视角大小


## 功能特性

- 可视化移动Puzzle过程
- 支持缩放视图
- 步进式查看搜索过程
- 动态显示当前节点移动方向
- 自动播放(空格键)和手动控制(方向键)
- 显示步数


## 整合注意事项

### 功能简述

先打开bin/Visualization.exe, 检查是否能正常运行,如果不能运行, 请检查是否按照安装SFML库的步骤正确安装了SFML库。

功能:

打开页面一共两个Puzzle, 左边是start state(读取./problems.txt中的第一个问题), 右边是goal state(默认的, 不可修改)

按上下左右可以移动空白块, reset按钮可以重置当前start state.

点击save to java会将当前的start state**覆盖**保存到problems.txt

点击Decrease会降低当前Puzzle的大小, 但是不能低于3x3, 点击Increase会增加当前Puzzle的大小, 但是不能超过4x4.

点击TreeView会跳转到可视化搜索树结构的页面。跳转后使用**左右方向键**即可查看下一步, 上一步,使用**a键**可以自动播放(再次点击a键可以暂停自动播放).同时可以使用鼠标中键进行拖拽视图, 缩放视图。

点击AnimationView会跳转到动画可视化搜索的页面。跳转后使用**左右方向键**可以查看下一步, 上一步, 也可以点击**空格**按钮自动播放(不是a键)。

进入TreeView和AnimationView后, 暂停自动播放情况下, **按b键**返回到主页面。


### 整合需要修改部分

1. 问题文件:在bin(在三阶段根目录下)的problem.txt(这里不带复数), 保证每次运行时problem.txt中只有一个问题.(格式: `大小 start的状态字符串 goal的状态字符串`(一般都是默认的从1到n^2-1,0表示空白格), 使用空格隔开)
2. 输出:
   - 搜索树结构: 输出到solution.txt
      - 格式: 每个节点占一行, 格式为: `节点编号(首节点为-1) p(父节点编号) g(到根节点的代价) h(启发式函数值) f(总代价) stateArray`(空格隔开), 也可也将g, h, f都默认为1(但是格式没改, 为了方便, 我就保留了g, h, f)
   - 搜索过程: 输出到solutionAction.txt(不过是基于problem.txt中的start state开始的)
      - 格式: 每个节点占一行, 格式为: `DOWN UP LEFT RIGHT`, 表示解决方案的四个移动方向(空格隔开)
